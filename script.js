$(function(){console.log("yt player");let e="",t="";const o=$("iframe"),n=$("#input-field"),i=$("#play"),l=$("#overlay"),a=$("#notification"),s=$("#overlay-notification"),r=$("#loader"),c=$("#help-modal"),d=$("form"),u=$("#expand-box"),m=$("#thumbnail"),p=$("#context-menu");let v=function(){return o.readyState,!0},f=!1;const y=/(?:(?:(?:http?(?:s)?:\/\/)?(?:www\.)?)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\/(?:embed\/|shorts\/|v\/|watch\?v=|watch\?(?:([^=]+)\=([^&]+))+&v=)))?((?:\w|-){11}|^(?:\w|-){11}$)((?:\&|\?)\S*)?/,b=/\s/g;function h(){e=n.val(),e=b.test(e)?e.replace(/\s/g,""):e,function(e){t=y.exec(e)[3],void 0!==o.attr("src")&&o.attr("src").includes(t)?(u.hide(),C(),i.blur()):x(t)}(e)}function w(){0===n.val().length?(K(),n.removeClass(),i.removeClass(),i.css("color","#1a1a1a"),i.prop("disabled",!0)):y.test(n.val())?(K(),n.addClass("correct"),n.removeClass("wrong"),i.addClass("valid"),i.css("color","#1a1a1a"),i.prop("disabled",!1)):(!function(e,t=0,o=0){a.text(e),0===t?a.addClass("normal"):1===t?a.addClass("correct"):-1===t?a.addClass("wrong"):console.error("Error setting notification");o>0?setTimeout(K,o*=1e3):0===o?console.log("No duration given for notification"):console.warn("Invalid notification duration given!")}("enter a valid url",-1),n.addClass("wrong"),n.removeClass("correct"),i.removeClass(),i.prop("disabled",!0),i.css("color","#c6262e"))}function x(e){C(),i.blur(),u.hide(),r.show(),f?(o.attr("src",`https://www.youtube-nocookie.com/embed/${e}?autoplay=1&dnt=1`),l.addClass("private-mode-overlay"),s.text("private mode enabled"),u.addClass("private-mode-expand"),$("#private-mode-context").text("turn private mode off")):(o.attr("src",`https://www.youtube.com/embed/${e}?autoplay=1`),l.removeClass("private-mode-overlay"),u.removeClass("private-mode-expand"),s.text(""),$("#private-mode-context").text("turn private mode on"))}function g(){let e=document.querySelector("iframe");0!==e.src.length&&v()?e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():alert("Unable to open video in full screen"):(console.warn("Error: unable to toggle full screen\nReason: no URL found"),alert("Unable to toggle full screen, video hasn't been loaded\nPlease enter a URL first"))}function k(){if(v()){let e=80*parseFloat(getComputedStyle(document.documentElement).fontSize),o=45*parseFloat(getComputedStyle(document.documentElement).fontSize),n=screen.width/2-e/2,i=screen.height/2-o/2;window.open("https://www.youtube.com/watch?v="+t,document.title,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+e+", height="+o+", top="+i+", left="+n)}else console.warn("Error: unable to open video in new tab\nReason: no URL found"),alert("Unable to open video in new tab, no URL entered\nPlay a video and try again")}function C(){l.show(),u.hide()}function E(){l.hide(),u.hide(),m.attr("src",""),e="",o.attr("src",""),n.removeClass(),i.removeClass(),i.css("color","#1a1a1a"),i.prop("disabled",!0),n.val(""),n.focus(),f=!1,l.removeClass("private-mode-overlay"),$("#private-mode-context").text("turn private mode on"),K()}function D(){l.hide(),u.show(),m.attr("src",m.attr("src")!==`https://i.ytimg.com/vi/${t}/mqdefault.jpg`?`https://i.ytimg.com/vi/${t}/mqdefault.jpg`:"")}function K(){a.text(""),a.removeClass()}let R,q=!1;l.mousemove(function(){q||(l.css("cursor",""),clearTimeout(R),R=setTimeout(function(){l.css("cursor","none"),q=!0,setTimeout(function(){q=!1},200)},2e3))}),$(document).on("keydown",function(e){if("input-field"!==document.activeElement.id)if("/"===e.key&&l.is(":hidden"))n.focus(),e.preventDefault();else if("Enter"!==e.key||e.shiftKey||e.altKey||!l.is(":hidden")){if((e.shiftKey||e.altKey)&&"Enter"===e.key&&l.is(":hidden"))return f=!0,d.submit(),e.preventDefault(),f;if((e.shiftKey||e.altKey)&&"Enter"===e.key&&l.is(":visible"))return f=!f,x(t),e.preventDefault(),f;"r"===e.key&&l.is(":visible")?(x(t),e.preventDefault()):"Escape"===e.key&&null===document.fullscreenElement&&l.is(":visible")?(D(),n.select(),e.preventDefault()):"f"===e.key&&null===document.fullscreenElement&&l.is(":visible")?(g(),e.preventDefault()):"m"===e.key&&l.is(":visible")?(D(),e.preventDefault()):"o"===e.key&&l.is(":hidden")&&0!==o.attr("src").length?(C(),i.blur(),e.preventDefault()):"?"===e.key&&(c.toggle(),e.preventDefault())}else d.submit(),e.preventDefault()}),window.onclick=e=>{"help-modal"==e.target.id&&c.hide()},o.on("load",function(){r.hide(),o.focus()}),$("form").on("submit",function(){h()}),u.on("click",function(){C(),i.blur(),u.hide(),m.attr("src","")}),n.on("keydown",function(e){if("Enter"!==e.key||e.shiftKey||e.altKey){if("Enter"===e.key&&(e.shiftKey||e.altKey))return f=!0,d.submit(),f}else d.submit()}),$(document).on("contextmenu",function(e){if(n.is(":focus")||$(document.activeElement).is("a"))return!0;e.preventDefault(),p.empty(),l.is(":visible")?p.append(`\n      <li id='reload-context' class="menu-item">reload video</li>\n      <li id='private-mode-context' class="menu-item">turn private mode ${f?"off":"on"}</li>\n      <li id='open-video-context' class="menu-item">open video on youtube</li>\n      <li id='enter-full-screen-context' class="menu-item">full screen</li>\n      <li id='copy-url-context' class="menu-item">copy video url</li>\n      <li id='copy-id-context' class="menu-item">copy video id</li>\n      <li id='close-player-context' class="menu-item">close player</li>\n      <li id='help-context' class="menu-item">help</li>\n    `):p.append('\n      <li id="play-context" class="menu-item">play video</li>\n      <li id="private-context" class="menu-item">play video in private mode</li>\n      <li id="clear-url-context" class="menu-item">clear url</li>\n      <li id=\'help-context\' class="menu-item">help</li>\n    '),p.toggle(),e.clientX+p.width()>$(window).width()?p.css("left",e.clientX-p.width()):p.css("left",e.clientX),e.clientY+p.height()>$(window).height()?p.css("top",e.clientY-p.height()):p.css("top",e.clientY)}),$(document).on("click",function(e){switch(p.hide(),e.target.id){case"play-context":w(),n.focus(),i.click();break;case"clear-url-context":n.val(""),n.focus();break;case"private-context":f=!f,w(),n.focus(),i.click();break;case"private-mode-context":f=!f,x(t);break;case"reload-context":x(t);break;case"open-video-context":f?confirm("Warning, this video is playing in private mode. If you open the video, it will show up as you viewing it and will not load if restricted mode is enabled for your YouTube account.\nDo you wish to still open the video?")&&k():k();break;case"copy-url-context":navigator.clipboard.writeText(o.attr("src"));break;case"copy-id-context":navigator.clipboard.writeText(t);break;case"enter-full-screen-context":g();break;case"close-player-context":E();break;case"help-context":c.show()}}),n.on("input",function(){w()}),i.on("click",function(e){return f=!(!e.shiftKey&&!e.altKey),d.submit(),f}),$(document).on("keydown",function(e){"Shift"!==e.key&&"Alt"!==e.key||!i.hasClass("valid")||(i.addClass("private-mode-button"),i.removeClass("valid"),i.attr("aria-label","play in private mode"),i.attr("data-balloon-visible",""))}),$(document).on("keyup",function(){i.hasClass("private-mode-button")&&(i.removeClass("private-mode-button"),i.addClass("valid"),i.attr("aria-label","play video"),i.removeAttr("data-balloon-visible"))}),$("#buttons-container").on("click",function(e){switch(e.target.id){case"close-button":E();break;case"fullscreen-button":g();break;case"minimize-button":D()}}),w()});